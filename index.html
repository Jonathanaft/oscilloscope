<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mono XY Oscilloscope</title>
<style>
  body {
    background: black;
    color: lime;
    font-family: monospace;
    text-align: center;
  }
  canvas {
    border: 1px solid lime;
    margin-top: 10px;
  }
  input, button {
    background: black;
    color: lime;
    border: 1px solid lime;
    padding: 6px;
    margin: 5px;
  }
</style>
</head>
<body>

<h1>ðŸŽµ Mono XY Oscilloscope</h1>

<input type="file" id="file" accept="audio/*">
<button id="play">Play</button>

<canvas id="scope" width="600" height="600"></canvas>

<script>
const fileInput = document.getElementById("file");
const playBtn = document.getElementById("play");
const canvas = document.getElementById("scope");
const ctx = canvas.getContext("2d");

let audioCtx;
let source;
let analyser;
let data;
let smooth = 0;

playBtn.onclick = async () => {
  if (!fileInput.files.length) return;

  if (!audioCtx)
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();

  const file = fileInput.files[0];
  const arrayBuffer = await file.arrayBuffer();
  const audioBuffer = await audioCtx.decodeAudioData(arrayBuffer);

  if (source) source.disconnect();

  source = audioCtx.createBufferSource();
  source.buffer = audioBuffer;

  analyser = audioCtx.createAnalyser();
  analyser.fftSize = 2048;
  analyser.smoothingTimeConstant = 0;

  data = new Uint8Array(analyser.fftSize);

  source.connect(analyser);
  source.connect(audioCtx.destination);
  source.start();

  draw();
};

function draw() {
  requestAnimationFrame(draw);

  analyser.getByteTimeDomainData(data);

  ctx.fillStyle = "rgba(0,0,0,0.2)";
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  ctx.fillStyle = "lime";

  const cx = canvas.width / 2;
  const cy = canvas.height / 2;
  const scale = 3;

  for (let i = 0; i < data.length; i++) {
    const x = data[i] - 128;

    // derived Y axis (integrator)
    smooth += (x - smooth) * 0.08;

    ctx.fillRect(
      cx + x * scale,
      cy + smooth * scale,
      1,
      1
    );
  }
}
</script>

</body>
</html>
