<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Mono XY Oscilloscope</title>
<style>
  body {
    background: black;
    color: lime;
    font-family: monospace;
    text-align: center;
  }
  canvas {
    border: 1px solid lime;
    margin-top: 10px;
  }
  button, input {
    background: black;
    color: lime;
    border: 1px solid lime;
    padding: 6px;
    margin: 5px;
  }
</style>
</head>
<body>

<h1>ðŸŽ¤ Mono XY Oscilloscope</h1>
<button id="start">Start Microphone</button>
<br>
<label>Phase Offset:
  <input id="phase" type="range" min="1" max="256" value="32">
</label>
<br>
<canvas id="scope" width="600" height="600"></canvas>

<script>
const button = document.getElementById("start");
const canvas = document.getElementById("scope");
const ctx = canvas.getContext("2d");
const phaseSlider = document.getElementById("phase");

let audioCtx, analyser, data;

button.onclick = async () => {
  audioCtx = new (window.AudioContext || window.webkitAudioContext)();

  const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
  const source = audioCtx.createMediaStreamSource(stream);

  analyser = audioCtx.createAnalyser();
  analyser.fftSize = 2048;
  analyser.smoothingTimeConstant = 0;

  data = new Uint8Array(analyser.fftSize);

  source.connect(analyser);
  drawXY();
};

function drawXY() {
  requestAnimationFrame(drawXY);

  analyser.getByteTimeDomainData(data);

  ctx.fillStyle = "rgba(0,0,0,0.25)";
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  ctx.fillStyle = "lime";

  const phase = Number(phaseSlider.value);
  const cx = canvas.width / 2;
  const cy = canvas.height / 2;
  const scale = 2.5;

  for (let i = 0; i < data.length; i++) {
    const xSample = data[i] - 128;
    const ySample = data[(i + phase) % data.length] - 128;

    const x = cx + xSample * scale;
    const y = cy + ySample * scale;

    ctx.fillRect(x, y, 1, 1);
  }
}
</script>

</body>
</html>
