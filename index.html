<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Jonathan's Online Oscilloscope (may be unaccurate/blurry)</title>
<style>
  body {
    background: black;
    color: lime;
    font-family: monospace;
    text-align: center;
  }
  canvas {
    border: 1px solid lime;
    margin-top: 10px;
  }
  input, button, label {
    background: black;
    color: lime;
    border: 1px solid lime;
    padding: 6px;
    margin: 5px;
  }
</style>
</head>
<body>

<h1>Jonathan's Online Oscilloscope</h1>

<input type="file" id="file" accept="audio/*">
<button id="play">Play</button>
<label>Phase Offset: <input type="range" id="phase" min="1" max="256" value="32"></label>

<canvas id="scope" width="600" height="600"></canvas>

<script>
const fileInput = document.getElementById("file");
const playBtn = document.getElementById("play");
const phaseSlider = document.getElementById("phase");
const canvas = document.getElementById("scope");
const ctx = canvas.getContext("2d");

let audioCtx;
let source;
let analyser;
let data;
let phase = 32;

playBtn.onclick = async () => {
  if (!fileInput.files.length) return;
  phase = Number(phaseSlider.value);

  if (!audioCtx)
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();

  const file = fileInput.files[0];
  const arrayBuffer = await file.arrayBuffer();
  const audioBuffer = await audioCtx.decodeAudioData(arrayBuffer);

  if (source) source.disconnect();

  source = audioCtx.createBufferSource();
  source.buffer = audioBuffer;

  analyser = audioCtx.createAnalyser();
  analyser.fftSize = 2048;
  analyser.smoothingTimeConstant = 0;

  data = new Uint8Array(analyser.fftSize);

  source.connect(analyser);
  source.connect(audioCtx.destination);
  source.start();

  draw();
};

phaseSlider.oninput = () => {
  phase = Number(phaseSlider.value);
};

function draw() {
  requestAnimationFrame(draw);

  analyser.getByteTimeDomainData(data);

  ctx.fillStyle = "rgba(0,0,0,0.2)";
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  ctx.fillStyle = "lime";

  const cx = canvas.width / 2;
  const cy = canvas.height / 2;
  const scale = 3;
  const len = data.length;

  for (let i = 0; i < len; i++) {
    const x = data[i] - 128;
    const y = data[(i + phase) % len] - 128;

    ctx.fillRect(cx + x * scale, cy + y * scale, 1, 1);
  }
}
</script>

</body>
</html>
