<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>XY Oscilloscope (Mic Detect)</title>
<style>
  body {
    background: black;
    color: lime;
    font-family: monospace;
    text-align: center;
  }
  canvas {
    border: 1px solid lime;
    margin-top: 10px;
  }
  button {
    background: black;
    color: lime;
    border: 1px solid lime;
    padding: 8px 16px;
    cursor: pointer;
  }
  #status {
    margin-top: 10px;
    font-size: 14px;
  }
  .warn {
    color: orange;
  }
</style>
</head>
<body>

<h1>üé§ XY Oscilloscope</h1>
<button id="start">Start Microphone</button>
<div id="status"></div>
<canvas id="scope" width="600" height="600"></canvas>

<script>
const button = document.getElementById("start");
const canvas = document.getElementById("scope");
const ctx = canvas.getContext("2d");
const status = document.getElementById("status");

let audioCtx, analyser, data;
let smoothY = 0;

button.onclick = async () => {
  audioCtx = new (window.AudioContext || window.webkitAudioContext)();

  const stream = await navigator.mediaDevices.getUserMedia({
    audio: { channelCount: 2 }
  });

  const track = stream.getAudioTracks()[0];
  const settings = track.getSettings();

  if (settings.channelCount === 1) {
    status.innerHTML =
      "‚ö†Ô∏è Mono microphone detected. For true oscilloscope music, use a stereo interface or audio source.";
    status.className = "warn";
  } else {
    status.innerHTML = "‚úÖ Stereo microphone detected.";
    status.className = "";
  }

  const source = audioCtx.createMediaStreamSource(stream);

  analyser = audioCtx.createAnalyser();
  analyser.fftSize = 2048;
  analyser.smoothingTimeConstant = 0;

  data = new Uint8Array(analyser.fftSize);

  source.connect(analyser);
  drawXY();
};

function drawXY() {
  requestAnimationFrame(drawXY);

  analyser.getByteTimeDomainData(data);

  ctx.fillStyle = "rgba(0,0,0,0.25)";
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  ctx.fillStyle = "lime";

  const cx = canvas.width / 2;
  const cy = canvas.height / 2;
  const scale = 3;

  for (let i = 0; i < data.length; i++) {
    const xSample = data[i] - 128;

    // mono ‚Üí derived Y axis
    smoothY += (xSample - smoothY) * 0.05;

    const x = cx + xSample * scale;
    const y = cy + smoothY * scale;

    ctx.fillRect(x, y, 1, 1);
  }
}
</script>

</body>
</html>
